webpackJsonp([4],{"2AnY":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("Gu7T"),s=a.n(r),o=a("vMJZ"),n=(a("PJh5"),a("JGfi")),i=a("G5DY"),l={name:"image-upload",props:{value:Array},data:function(){return{uploadList:[],previewModal:!1,hiddenUpload:!1,uploadPath:"http://localhost:3002/api/addOrUpload"}},mounted:function(){var e=this;this.$nextTick(function(){e.value.length&&(e.uploadList.push(e.value),e.hiddenUpload=!0)})},methods:{handleView:function(e){this.imgName=e,this.previewModal=!0,this.$emit("showParentModel",!1)},modelVisibleChange:function(e){this.$emit("showParentModel",!e)},handleBeforeUpload:function(e){var t=this;if(console.log(e),e.size>5e5)return this.$Notice.warning({title:"超出文件大小限制",desc:"文件 "+e.name+" 太大，不能超过 500kb。"}),!1;this.uploadList=[];var a=new FileReader;return a.readAsDataURL(e),a.onloadend=function(r){e.url=a.result,t.value.push(e)},console.log(this.value),this.hiddenUpload=!0,!1},handleRemove:function(e){this.uploadList.splice(this.uploadList.indexOf(e),1),this.hiddenUpload=!1}},watch:{value:function(e){e.length?(this.uploadList=e,this.hiddenUpload=!0):(this.uploadList=[],this.hiddenUpload=!1)}}},u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"image-upload"},[e._l(e.uploadList,function(t){return a("div",{key:t.name,staticClass:"preview-list"},[t.url?[a("img",{attrs:{src:t.url}}),e._v(" "),a("div",{staticClass:"preview-list-cover"},[a("Icon",{attrs:{type:"ios-eye-outline"},nativeOn:{click:function(a){e.handleView(t.name)}}}),e._v(" "),a("Icon",{attrs:{type:"ios-trash-outline"},nativeOn:{click:function(a){e.handleRemove(t)}}})],1)]:e._e()],2)}),e._v(" "),e.hiddenUpload?e._e():a("Upload",{ref:"upload",staticStyle:{display:"inline-block",width:"78px"},attrs:{action:e.uploadPath,type:"drag",accept:".jpg, .jpeg, .png","show-upload-list":!1,"before-upload":e.handleBeforeUpload}},[a("div",{staticStyle:{width:"78px",height:"78px","line-height":"78px"}},[a("Icon",{attrs:{type:"camera",size:"20"}})],1)]),e._v(" "),e._m(0),e._v(" "),a("Modal",{attrs:{title:"头像预览"},on:{"on-visible-change":e.modelVisibleChange},model:{value:e.previewModal,callback:function(t){e.previewModal=t},expression:"previewModal"}},[e.previewModal?a("img",{staticStyle:{width:"500px"},attrs:{src:e.uploadList[0].url}}):e._e()])],2)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("ul",{staticClass:"upload-tip"},[t("li",[this._v("每次只能上传1张图片。")]),this._v(" "),t("li",[this._v("每个文件大小不超过 500kb。")]),this._v(" "),t("li",[this._v("文件必须是 jpg 、png 或 jpeg 格式的图片。")])])}]};var d=a("VU/8")(l,u,!1,function(e){a("H/2i")},null,null).exports,c={name:"user",data:function(){return{queryName:"",queryAuth:"",tableLoading:!1,userModal:!1,modalLoading:!1,modalType:1,userForm:{id:"",username:"",password:"",auth:"1",oldPwd:"",newPwd:"",comfirmPwd:""},userFormRule:{username:[{required:!0,message:"用户名不能为空",trigger:"blur"}],password:[{required:!0,message:"密码不能为空",trigger:"blur"}],oldPwd:[{required:!0,message:"原始密码不能为空",trigger:"blur"}],newPwd:[{required:!0,message:"新密码不能为空",trigger:"blur"}],comfirmPwd:[{required:!0,message:"确认密码不能为空",trigger:"blur"}],auth:[{required:!0,message:"请选择权限",trigger:"change"}]},tableColumn:[],tableData:[],total:0,currentPage:1,pageSize:10,authList:[{value:"4",label:"全部"},{value:"3",label:"用户"},{value:"2",label:"管理员"},{value:"1",label:"超级管理员"}],previewModal:!1,hiddenUpload:!1,uploadList:[],uploadPath:"http://localhost:3002/api/addOrUpload"}},created:function(){this._getColumn()},mounted:function(){var e=this;this.$nextTick(function(){e._getUser()})},methods:{_getColumn:function(){this.tableColumn=n.a.userTableColumn},_getUser:function(){var e=this;this.tableLoading=!0;var t={currentPage:this.currentPage,pageSize:this.pageSize,queryName:this.queryName,queryAuth:this.queryAuth};Object(o.d)(t).then(function(t){t.data.success?(e.tableData=[].concat(s()(t.data.data.list)),e.total=t.data.data.pagination.total,e.currentPage=t.data.data.pagination.currentPage,e.pageSize=t.data.data.pagination.pageSize):e.$Message.error(t.data.msg),e.tableLoading=!1})},onCurrentPageChange:function(e){this.currentPage=e,this._getUser()},onPageSizeChange:function(e){this.currentPage=1,this.pageSize=e,this._getUser()},add:function(){this.userModal=!0,this.modalType=1},modelVisibleChange:function(e){e||this.resetForm()},query:function(){this._getUser()},edit:function(e,t){this.userModal=!0,this.userForm.id=e._id,this.userForm.username=e.username,this.userForm.auth=String(e.auth),e.avator&&(this.uploadList.push({name:e.username,url:"http://localhost:3002/"+e.avator}),this.hiddenUpload=!0),this.modalType=2},remove:function(e,t){var a=this;Object(o.b)(e._id).then(function(e){e.data.success?(a._getUser(),a.$Message.success(e.data.msg)):a.$Message.success(e.data.msg)})},addOrEdit:function(){var e=this;this.$refs.userFormObj.validate(function(t){if(t){e.modalLoading=!0;var a=new FormData;e.uploadList.length&&a.append("file",e.uploadList[0]),a.append("username",e.userForm.username),a.append("auth",e.userForm.auth),1===e.modalType?(a.append("password",e.userForm.password),Object(o.a)(a).then(function(t){t.data.success?(e.modalLoading=!1,e.userModal=!1,e.resetForm(),e._getUser(),e.$Message.success(t.data.msg)):(e.modalLoading=!1,e.$Message.error(t.data.msg))})):(a.append("id",e.userForm.id),a.append("oldPwd",e.userForm.oldPwd),a.append("newPwd",e.userForm.newPwd),a.append("comfirmPwd",e.userForm.comfirmPwd),Object(o.c)(a).then(function(t){console.log(t),t.data.success?(e.modalLoading=!1,e.userModal=!1,e.resetForm(),e._getUser(),e.$Message.success(t.data.msg)):(e.modalLoading=!1,e.$Message.error(t.data.msg))}))}else e.$Message.error("请正确输入表单内容！")})},resetForm:function(){this.$refs.userFormObj.resetFields(),this.userForm.auth="1",this.userForm.password="",this.userForm.id="",this.userForm.oldPwd="",this.userForm.newPwd="",this.userForm.comfirmPwd="",this.hiddenUpload=!1,this.uploadList=[]},showUserModel:function(e){this.userModal=e}},components:{baseTable:i.a,imageUpload:d}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"user"},[a("Row",{attrs:{gutter:20}},[a("Col",{attrs:{sm:8,md:6,lg:4}},[a("Input",{attrs:{placeholder:"请输入用户名称"},model:{value:e.queryName,callback:function(t){e.queryName=t},expression:"queryName"}})],1),e._v(" "),a("Col",{attrs:{sm:7,md:5,lg:3}},[a("Select",{attrs:{placeholder:"请选择权限类型"},model:{value:e.queryAuth,callback:function(t){e.queryAuth=t},expression:"queryAuth"}},e._l(e.authList,function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])}))],1),e._v(" "),a("Col",{attrs:{sm:8,md:8,lg:5}},[a("Button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary",icon:"search",shape:"circle"},on:{click:e.query}},[e._v("搜索")]),e._v(" "),a("Button",{attrs:{type:"primary",icon:"plus",shape:"circle"},on:{click:e.add}},[e._v("新增")]),e._v(" "),a("Modal",{attrs:{title:1===e.modalType?"新增管理员":"编辑管理员"},on:{"on-visible-change":e.modelVisibleChange},model:{value:e.userModal,callback:function(t){e.userModal=t},expression:"userModal"}},[a("Form",{ref:"userFormObj",attrs:{model:e.userForm,rules:e.userFormRule,"label-width":100}},[a("FormItem",{attrs:{label:"用户名",prop:"username"}},[a("Input",{attrs:{type:"text",placeholder:"请输入用户名",disabled:1!==e.modalType},model:{value:e.userForm.username,callback:function(t){e.$set(e.userForm,"username",t)},expression:"userForm.username"}})],1),e._v(" "),1===e.modalType?a("FormItem",{attrs:{label:"密码",prop:"password"}},[a("Input",{attrs:{type:"password",placeholder:"请输入密码"},model:{value:e.userForm.password,callback:function(t){e.$set(e.userForm,"password",t)},expression:"userForm.password"}})],1):a("div",[a("FormItem",{attrs:{label:"原始密码",prop:"oldPwd"}},[a("Input",{attrs:{type:"password",placeholder:"请输入原始密码"},model:{value:e.userForm.oldPwd,callback:function(t){e.$set(e.userForm,"oldPwd",t)},expression:"userForm.oldPwd"}})],1),e._v(" "),a("FormItem",{attrs:{label:"新密码",prop:"newPwd"}},[a("Input",{attrs:{type:"password",placeholder:"请输入新密码"},model:{value:e.userForm.newPwd,callback:function(t){e.$set(e.userForm,"newPwd",t)},expression:"userForm.newPwd"}})],1),e._v(" "),a("FormItem",{attrs:{label:"确认密码",prop:"comfirmPwd"}},[a("Input",{attrs:{type:"password",placeholder:"请确认新密码"},model:{value:e.userForm.comfirmPwd,callback:function(t){e.$set(e.userForm,"comfirmPwd",t)},expression:"userForm.comfirmPwd"}})],1)],1),e._v(" "),a("FormItem",{attrs:{label:"权限",prop:"auth"}},[a("Select",{attrs:{placeholder:"请选择权限"},model:{value:e.userForm.auth,callback:function(t){e.$set(e.userForm,"auth",t)},expression:"userForm.auth"}},[a("Option",{attrs:{value:"1"}},[e._v("超级管理员")]),e._v(" "),a("Option",{attrs:{value:"2"}},[e._v("管理员")]),e._v(" "),a("Option",{attrs:{value:"3"}},[e._v("用户")])],1)],1),e._v(" "),a("FormItem",{attrs:{label:"头像",prop:"avator"}},[a("imageUpload",{on:{showParentModel:e.showUserModel},model:{value:e.uploadList,callback:function(t){e.uploadList=t},expression:"uploadList"}})],1)],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"text"},on:{click:function(t){e.userModal=!1}}},[e._v("取消")]),e._v(" "),a("Button",{attrs:{type:"primary",loading:e.modalLoading},on:{click:e.addOrEdit}},[e._v("提交")])],1)],1)],1)],1),e._v(" "),a("baseTable",{attrs:{columnList:e.tableColumn,total:e.total,currentPage:e.currentPage,pageSize:e.pageSize,loading:e.tableLoading},on:{"on-edit":e.edit,"on-delete":e.remove,"on-page-change":e.onCurrentPageChange,"on-size-change":e.onPageSizeChange},model:{value:e.tableData,callback:function(t){e.tableData=t},expression:"tableData"}})],1)},staticRenderFns:[]};var m=a("VU/8")(c,p,!1,function(e){a("lwVs")},"data-v-78890a03",null);t.default=m.exports},"H/2i":function(e,t){},lwVs:function(e,t){},vMJZ:function(e,t,a){"use strict";a.d(t,"d",function(){return v}),a.d(t,"b",function(){return f}),a.d(t,"a",function(){return w}),a.d(t,"c",function(){return b});var r,s,o,n,i,l=a("Xxa5"),u=a.n(l),d=a("Dd8w"),c=a.n(d),p=a("exGp"),m=a.n(p),h=a("qP6z"),g=a("mw3O"),v=(r=m()(u.a.mark(function e(t){var a;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a="/addUser",e.next=3,Object(h.a)({url:a,method:"post",data:g.stringify(c()({},t))});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),s=m()(u.a.mark(function e(t){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.a)({url:"/getUser",method:"get",params:c()({},t)});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)}),f=(o=m()(u.a.mark(function e(t){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.a)({url:"/deleteUser/"+t,method:"delete"});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)}),w=(n=m()(u.a.mark(function e(t){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.a)({headers:{"Content-Type":"multipart/form-data"},url:"/addOrUpload",method:"post",data:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)}),b=(i=m()(u.a.mark(function e(t){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.a)({headers:{"Content-Type":"multipart/form-data"},url:"/editOrUpload",method:"put",data:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})}});
//# sourceMappingURL=4.31947df7dce63c42eafb.js.map